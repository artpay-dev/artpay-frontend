import { PiCreditCardThin } from "react-icons/pi";
import ContentCard from "../../../components/ContentCard.tsx";
import PaymentRadioSelector from "../../../components/PaymentRadioSelector.tsx";
import { useDirectPurchase } from "../contexts/DirectPurchaseContext.tsx";
import { KLARNA_FEE, KLARNA_MAX_LIMIT } from "../../../constants.ts";
import GooglePayMark from "../../../components/icons/GooglePayMark.tsx";

interface PaymentsSelectionProps {
  paymentMethod: string | null;
  onChange: (paymentMethod: string) => void;
}

const PaymentsSelection = ({ paymentMethod, onChange }: PaymentsSelectionProps) => {

  const { orderMode, pendingOrder, loading } = useDirectPurchase();

  // Calcola il totale dell'ordine (incluse commissioni)
  const orderTotal = Number(pendingOrder?.total || 0);

  // Determina se un metodo di pagamento è disponibile in base all'importo
  const isPaymentMethodAvailable = (method: string): boolean => {
    switch (method) {
      case "klarna":
        // Calcola il totale con la fee di Klarna (6.1%) e verifica che non superi il limite
        const totalWithKlarnaFee = orderTotal * KLARNA_FEE;
        return totalWithKlarnaFee <= KLARNA_MAX_LIMIT;
      default:
        return true;
    }
  };

  const klarnaAvailable = isPaymentMethodAvailable("klarna");

  const hasQuestionId = Boolean(
    pendingOrder?.meta_data.find(k => k.key === "_question_id")?.value
  );

  const showKlarna = klarnaAvailable && (orderMode !== "redeem" || hasQuestionId);

  // Per gli ordini deposit, mostra solo Santander e Klarna
  const isDepositOrder = orderMode === "deposit";

  const paymentMethods = {
    Santander: {
      value: "Santander",
      label: "Santander",
      description: "Finanzia fino a 30.000 €, in max 84 rate, soggetto ad approvazione dell'istituto di credito.",
      icon: (
        <svg width="24" height="24" viewBox="0 0 34 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="0.5" y="0.5" width="33" height="23" rx="3.5" fill="#EA1D25" />
          <rect x="0.5" y="0.5" width="33" height="23" rx="3.5" stroke="#F9F7F6" />
          <path
            d="M19.6526 10.2795C19.9083 10.6554 20.0362 11.0892 20.0682 11.5229C22.4334 12.0723 24.0315 13.2578 23.9995 14.559C23.9995 16.4675 20.8672 18 16.9998 18C13.1323 18 10 16.4675 10 14.559C10 13.2 11.6301 12.0145 13.9633 11.4651C13.9633 11.9855 14.0912 12.506 14.3788 12.9687L16.5843 16.4096C16.7441 16.6699 16.8719 16.959 16.9358 17.2482L17.0317 17.1036C17.5751 16.2651 17.5751 15.1952 17.0317 14.3566L15.2738 11.6096C14.7304 10.7422 14.7304 9.7012 15.2738 8.86265L15.3697 8.71807C15.4336 9.00723 15.5615 9.29639 15.7213 9.55663L16.7441 11.1759L18.3422 13.6916C18.502 13.9518 18.6298 14.241 18.6938 14.5301L18.7897 14.3855C19.333 13.547 19.333 12.4771 18.7897 11.6386L17.0317 8.89157C16.4884 8.05301 16.4884 6.98313 17.0317 6.14458L17.1276 6C17.1915 6.28916 17.3194 6.57831 17.4792 6.83855L19.6526 10.2795Z"
            fill="white"
          />
        </svg>
      ),
    },
    klarna: {
      value: "klarna",
      label: "Klarna",
      description: "Paga in 3 rate fino a €2.500",
      icon: (
        <svg width="34" height="24" viewBox="0 0 34 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="0.5" y="0.5" width="33" height="23" rx="3.5" fill="#FEB4C7" />
          <rect x="0.5" y="0.5" width="33" height="23" rx="3.5" stroke="#F9F7F6" />
          <path
            d="M13.6396 10.8447C14.0986 10.8447 14.5244 10.9945 14.877 11.249V10.9668H16.125V15.3779H14.877V15.0957C14.5244 15.3502 14.0986 15.5 13.6396 15.5C12.4252 15.5 11.4406 14.4581 11.4404 13.1729C11.4404 11.8874 12.425 10.8448 13.6396 10.8447ZM26.8047 10.8447C27.2637 10.8447 27.6895 10.9945 28.042 11.249V10.9668H29.29V15.3779H28.042V15.0957C27.6895 15.3502 27.2637 15.5 26.8047 15.5C25.5902 15.5 24.6057 14.4581 24.6055 13.1729C24.6055 11.8874 25.5901 10.8448 26.8047 10.8447ZM30.6143 13.8135C31.0466 13.8137 31.3975 14.185 31.3975 14.6426C31.3972 15.0999 31.0464 15.4705 30.6143 15.4707C30.1819 15.4707 29.8313 15.1 29.8311 14.6426C29.8311 14.1848 30.1818 13.8135 30.6143 13.8135ZM5.26855 9V15.3799H3.88477V9H5.26855ZM8.72266 9C8.72266 10.3811 8.21382 11.6661 7.30762 12.6211L9.21973 15.3799H7.51172L5.43359 12.3818L5.96973 11.957C6.85897 11.2521 7.36914 10.174 7.36914 9H8.72266ZM10.9287 15.3779H9.62207V9.00098H10.9287V15.3779ZM18.0547 11.542C18.3048 11.1974 18.7716 10.9678 19.2783 10.9678V12.251C19.2733 12.2509 19.2677 12.25 19.2627 12.25C18.769 12.2502 18.0577 12.6239 18.0576 13.3184V15.3779H16.7773V10.9668H18.0547V11.542ZM22.3877 10.8486C23.3929 10.8487 24.1641 11.5468 24.1641 12.5732V15.3779H22.918V13.0508C22.918 12.4074 22.6021 12.0605 22.0537 12.0605C21.5421 12.0606 21.1173 12.3891 21.1172 13.0596V15.3779H19.8594V10.9668H21.1016V11.4639C21.417 11.012 21.8892 10.8486 22.3877 10.8486ZM13.7422 12.0381C13.1177 12.0381 12.6113 12.5461 12.6113 13.1729C12.6115 13.7995 13.1179 14.3076 13.7422 14.3076C14.3666 14.3076 14.8729 13.7995 14.873 13.1729C14.873 12.5461 14.3667 12.0381 13.7422 12.0381ZM26.9072 12.0381C26.2827 12.0381 25.7764 12.5461 25.7764 13.1729C25.7766 13.7995 26.2828 14.3076 26.9072 14.3076C27.5316 14.3076 28.0379 13.7995 28.0381 13.1729C28.0381 12.5461 27.5317 12.0381 26.9072 12.0381Z"
            fill="#17120F"
          />
        </svg>
      ),
    },
    card: {
      value: "card",
      label: "Carta di credito",
      description: "Paga con Visa, Mastercard o American Express.",
      icon: (
        <svg width="160" height="24" viewBox="0 0 160 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="42.5" y="0.5" width="33" height="23" rx="3.5" fill="white" />
          <rect x="42.5" y="0.5" width="33" height="23" rx="3.5" stroke="#F9F7F6" />
          <path
            d="M63.5771 5.02997C67.322 5.02997 70.3584 8.02986 70.3584 11.7302C70.3583 15.4304 67.322 18.4304 63.5771 18.4304C61.8982 18.4303 60.3629 17.8256 59.1787 16.8268C57.9945 17.8254 56.4591 18.4304 54.7803 18.4304C51.0357 18.4301 48.0001 15.4302 48 11.7302C48 8.02999 51.0356 5.03019 54.7803 5.02997C56.459 5.02997 57.9945 5.63405 59.1787 6.63251C60.3628 5.63388 61.8984 5.03007 63.5771 5.02997Z"
            fill="#ED0006"
          />
          <path
            d="M63.5771 5.02997C67.322 5.02997 70.3584 8.02986 70.3584 11.7302C70.3583 15.4304 67.322 18.4304 63.5771 18.4304C61.8985 18.4303 60.3638 17.8253 59.1797 16.8268C60.6369 15.598 61.5624 13.7715 61.5625 11.7302C61.5625 9.6886 60.6371 7.86141 59.1797 6.63251C60.3637 5.63417 61.8986 5.03007 63.5771 5.02997Z"
            fill="#F9A000"
          />
          <path
            d="M59.1787 6.63251C60.6362 7.86141 61.5615 9.6886 61.5615 11.7302C61.5615 13.7715 60.636 15.598 59.1787 16.8268C57.7217 15.598 56.7969 13.7713 56.7969 11.7302C56.7969 9.68882 57.7215 7.8614 59.1787 6.63251Z"
            fill="#FF5E00"
          />
          <rect x="84.5" y="0.5" width="33" height="23" rx="3.5" fill="#1F72CD" />
          <rect x="84.5" y="0.5" width="33" height="23" rx="3.5" stroke="#F9F7F6" />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M90.0952 8.5L86.9141 15.7467H90.7223L91.1944 14.5913H92.2735L92.7457 15.7467H96.9375V14.8649L97.311 15.7467H99.4793L99.8528 14.8462V15.7467H108.571L109.631 14.6213L110.623 15.7467L115.101 15.7561L111.91 12.1436L115.101 8.5H110.693L109.661 9.60463L108.699 8.5H99.2156L98.4013 10.3704L97.5678 8.5H93.7675V9.35186L93.3447 8.5H90.0952ZM90.8324 9.52905H92.6887L94.7987 14.4431V9.52905H96.8322L98.462 13.0524L99.964 9.52905H101.987V14.7291H100.756L100.746 10.6544L98.9512 14.7291H97.8499L96.0449 10.6544V14.7291H93.5121L93.032 13.5633H90.4378L89.9586 14.728H88.6016L90.8324 9.52905ZM108.12 9.52905H103.113V14.726H108.042L109.631 13.0036L111.162 14.726H112.762L110.436 12.1426L112.762 9.52905H111.231L109.651 11.2316L108.12 9.52905ZM91.7355 10.4089L90.8809 12.4857H92.5892L91.7355 10.4089ZM104.35 11.555V10.6057V10.6048H107.473L108.836 12.1229L107.413 13.6493H104.35V12.613H107.081V11.555H104.35Z"
            fill="white"
          />
          <rect x="126.5" y="0.5" width="33" height="23" rx="3.5" fill="white" />
          <rect x="126.5" y="0.5" width="33" height="23" rx="3.5" stroke="#F9F7F6" />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M136.751 15.8582H134.691L133.147 9.79235C133.073 9.51332 132.918 9.26664 132.689 9.15038C132.117 8.85821 131.488 8.62568 130.801 8.50841V8.27487H134.119C134.577 8.27487 134.92 8.62568 134.978 9.0331L135.779 13.4086L137.838 8.27487H139.84L136.751 15.8582ZM140.985 15.8581H139.04L140.642 8.27478H142.587L140.985 15.8581ZM145.103 10.3757C145.161 9.96725 145.504 9.73372 145.905 9.73372C146.535 9.67508 147.22 9.79235 147.793 10.0835L148.136 8.45079C147.564 8.21725 146.934 8.09998 146.363 8.09998C144.475 8.09998 143.101 9.15038 143.101 10.6082C143.101 11.7173 144.074 12.2996 144.761 12.6504C145.504 13.0002 145.79 13.2337 145.733 13.5835C145.733 14.1082 145.161 14.3418 144.589 14.3418C143.902 14.3418 143.215 14.1669 142.587 13.8747L142.243 15.5084C142.93 15.7996 143.673 15.9169 144.36 15.9169C146.477 15.9745 147.793 14.9251 147.793 13.35C147.793 11.3664 145.103 11.2502 145.103 10.3757ZM154.6 15.8581L153.056 8.27478H151.397C151.053 8.27478 150.71 8.50832 150.595 8.85812L147.735 15.8581H149.738L150.138 14.7501H152.598L152.827 15.8581H154.6ZM151.684 10.317L152.255 13.1751H150.653L151.684 10.317Z"
            fill="#172B85"
          />
          <defs>
            <clipPath id="clip0_935_2">
              <rect width="16" height="16" fill="white" transform="translate(9 4)" />
            </clipPath>
          </defs>
        </svg>
      ),
    },
    paypal: {
      value: "paypal",
      label: "PayPal",
      description: "Paga con il tuo account PayPal.",
      icon: (
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 -139.5 750 750" version="1.1" className={'size-10'}>
          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="paypal" fill-rule="nonzero">
              <path
                d="M697.115385,0 L52.8846154,0 C23.7240385,0 0,23.1955749 0,51.7065868 L0,419.293413 C0,447.804425 23.7240385,471 52.8846154,471 L697.115385,471 C726.274038,471 750,447.804425 750,419.293413 L750,51.7065868 C750,23.1955749 726.274038,0 697.115385,0 Z"
                id="Shape"
                fill="#FFFFFF"></path>
              <g id="Group" transform="translate(54.000000, 150.000000)">
                <path
                  d="M109.272795,8.45777679 C101.24875,2.94154464 90.7780357,0.176741071 77.8606518,0.176741071 L27.8515268,0.176741071 C23.8915714,0.176741071 21.7038036,2.15719643 21.2882232,6.11333036 L0.972553571,133.638223 C0.761419643,134.890696 1.07477679,136.03617 1.90975893,137.077509 C2.73996429,138.120759 3.78416964,138.639518 5.03473214,138.639518 L28.7887321,138.639518 C32.9550446,138.639518 35.2450357,136.663839 35.6653929,132.701973 L41.2905357,98.3224911 C41.4959375,96.6563482 42.2286964,95.3016518 43.4792589,94.2584018 C44.7288661,93.2170625 46.2918304,92.5358929 48.1671964,92.2234911 C50.0425625,91.9139554 51.8109286,91.7582321 53.4808929,91.7582321 C55.1460804,91.7582321 57.124625,91.8633214 59.4203482,92.0706339 C61.7103393,92.2789018 63.170125,92.3801696 63.7958839,92.3801696 C81.7145625,92.3801696 95.7793304,87.3311071 105.991143,77.2224732 C116.198179,67.1176607 121.307429,53.1054375 121.307429,35.1829375 C121.307429,22.8903571 117.293018,13.9826071 109.272795,8.45777679 Z M83.4877054,46.7484911 C82.4425446,54.0426429 79.7369732,58.8328036 75.3614375,61.1256607 C70.9849464,63.4213839 64.7340446,64.5620804 56.6087321,64.5620804 L46.2937411,64.8754375 L51.6083929,31.43125 C52.0230179,29.1412589 53.3767589,27.9948304 55.6705714,27.9948304 L61.6109821,27.9948304 C69.9416964,27.9948304 75.9881518,29.1957143 79.7388839,31.5879286 C83.4877054,33.985875 84.7382679,39.041625 83.4877054,46.7484911 Z"
                  id="Shape"
                  fill="#003087"></path>
                <path
                  d="M637.026411,0.176741071 L613.899125,0.176741071 C611.601491,0.176741071 610.248705,1.32316964 609.835991,3.61507143 L589.518411,133.638223 L589.205054,134.263027 C589.205054,135.310098 589.622545,136.295071 590.457527,137.233232 C591.286777,138.169482 592.332893,138.638562 593.581545,138.638562 L614.212482,138.638562 C618.16575,138.638562 620.354473,136.662884 620.776741,132.701018 L641.092411,4.86276786 L641.092411,4.55227679 C641.091455,1.63557143 639.732938,0.176741071 637.026411,0.176741071 Z"
                  id="Shape"
                  fill="#009CDE"></path>
                <path
                  d="M357.599732,50.4973125 C357.599732,49.4578839 357.18033,48.4662232 356.352036,47.5299732 C355.516098,46.5927679 354.576982,46.1217768 353.538509,46.1217768 L329.471152,46.1217768 C327.174473,46.1217768 325.300063,47.1688482 323.845054,49.24675 L290.714223,98.0081786 L276.962812,51.1240268 C275.916696,47.7917411 273.62575,46.1217768 270.086152,46.1217768 L246.641687,46.1217768 C245.597482,46.1217768 244.659321,46.5918125 243.831027,47.5299732 C242.995089,48.4662232 242.580464,49.4588393 242.580464,50.4973125 C242.580464,50.9176696 244.612509,57.0615714 248.674687,68.9385714 C252.736866,80.8174821 257.113357,93.6326429 261.80225,107.38692 C266.491143,121.137375 268.936857,128.434393 269.147036,129.262688 C252.059518,152.602063 243.51767,165.104821 243.51767,166.769054 C243.51767,169.480357 244.871411,170.833143 247.580804,170.833143 L271.648161,170.833143 C273.940062,170.833143 275.814473,169.793714 277.274259,167.709125 L356.976839,52.6850804 C357.391464,52.2704554 357.599732,51.5443839 357.599732,50.4973125 Z"
                  id="Shape"
                  fill="#003087"></path>
                <path
                  d="M581.704545,46.1217768 L557.948634,46.1217768 C555.030018,46.1217768 553.263562,49.5601071 552.638759,56.4367679 C547.215196,48.1060536 537.323429,43.9330536 522.943393,43.9330536 C507.940464,43.9330536 495.174982,49.5601071 484.655545,60.8123036 C474.13133,72.0654554 468.872089,85.2990625 468.872089,100.508348 C468.872089,112.80475 472.465187,122.597161 479.653295,129.887491 C486.842357,137.185464 496.479045,140.827286 508.568134,140.827286 C514.608857,140.827286 520.755625,139.574813 527.006527,137.076554 C533.258384,134.576384 538.150768,131.244098 541.698964,127.07492 C541.698964,127.284143 541.486875,128.220393 541.073205,129.886536 C540.652848,131.5565 540.447446,132.808973 540.447446,133.637268 C540.447446,136.975286 541.798321,138.637607 544.511536,138.637607 L566.079679,138.637607 C570.032946,138.637607 572.32867,136.661929 572.952518,132.700063 L585.768634,51.1230714 C585.974036,49.8725089 585.661634,48.7279911 584.830473,47.6847411 C583.994536,46.6443571 582.955107,46.1217768 581.704545,46.1217768 Z M540.916527,107.696455 C535.60283,112.906018 529.196205,115.509366 521.694741,115.509366 C515.649241,115.509366 510.756857,113.845134 507.004214,110.509027 C503.252527,107.180563 501.377161,102.595804 501.377161,96.7566607 C501.377161,89.0517054 503.981464,82.5361696 509.191982,77.2224732 C514.395812,71.9087768 520.860714,69.2519286 528.571402,69.2519286 C534.400036,69.2519286 539.245607,70.9715714 543.104295,74.4089464 C546.956295,77.8472768 548.888027,82.5896696 548.888027,88.6323036 C548.887071,96.1328125 546.229268,102.489759 540.916527,107.696455 Z"
                  id="Shape"
                  fill="#009CDE"></path>
                <path
                  d="M226.639375,46.1217768 L202.885375,46.1217768 C199.963893,46.1217768 198.196482,49.5601071 197.570723,56.4367679 C191.944625,48.1060536 182.04617,43.9330536 167.877268,43.9330536 C152.874339,43.9330536 140.109813,49.5601071 129.588464,60.8123036 C119.06425,72.0654554 113.805009,85.2990625 113.805009,100.508348 C113.805009,112.80475 117.400018,122.597161 124.58908,129.887491 C131.778143,137.185464 141.41292,140.827286 153.500098,140.827286 C159.331598,140.827286 165.378054,139.574813 171.628,137.076554 C177.878902,134.576384 182.880196,131.244098 186.630929,127.07492 C185.794991,129.575089 185.380366,131.763813 185.380366,133.637268 C185.380366,136.975286 186.734107,138.637607 189.4435,138.637607 L211.009732,138.637607 C214.965866,138.637607 217.260634,136.661929 217.886393,132.700063 L230.700598,51.1230714 C230.906,49.8725089 230.593598,48.7279911 229.763393,47.6847411 C228.929366,46.6443571 227.888982,46.1217768 226.639375,46.1217768 Z M185.850402,107.851223 C180.53575,112.962384 174.02117,115.509366 166.316214,115.509366 C160.269759,115.509366 155.425143,113.845134 151.781411,110.509027 C148.132902,107.180563 146.311036,102.595804 146.311036,96.7566607 C146.311036,89.0517054 148.914384,82.5361696 154.125857,77.2224732 C159.331598,71.9087768 165.791723,69.2519286 173.504321,69.2519286 C179.335821,69.2519286 184.180437,70.9715714 188.039125,74.4089464 C191.891125,77.8472768 193.820946,82.5896696 193.820946,88.6323036 C193.820946,96.3420357 191.164098,102.751527 185.850402,107.851223 Z"
                  id="Shape"
                  fill="#003087"></path>
                <path
                  d="M464.337964,8.45777679 C456.314875,2.94154464 445.846071,0.176741071 432.926777,0.176741071 L383.230054,0.176741071 C379.05992,0.176741071 376.767062,2.15719643 376.353393,6.11333036 L356.037723,133.637268 C355.826589,134.889741 356.138991,136.035214 356.974929,137.076554 C357.802268,138.119804 358.849339,138.638563 360.099902,138.638563 L385.728312,138.638563 C388.228482,138.638563 389.894625,137.285777 390.729607,134.576384 L396.356661,98.3215357 C396.563018,96.6553929 397.292911,95.3006964 398.544429,94.2574464 C399.794991,93.2161071 401.356045,92.5349375 403.233321,92.2225357 C405.107732,91.913 406.876098,91.7572768 408.547018,91.7572768 C410.212205,91.7572768 412.19075,91.8623661 414.483607,92.0696786 C416.775509,92.2779464 418.238161,92.3792143 418.859143,92.3792143 C436.780687,92.3792143 450.843545,87.3301518 461.055357,77.2215179 C471.265259,67.1167054 476.370687,53.1044821 476.370687,35.1819821 C476.371643,22.8903571 472.358187,13.9826071 464.337964,8.45777679 Z M432.301018,59.8750982 C427.716259,63.0000714 420.839598,64.5620804 411.672946,64.5620804 L401.670357,64.8754375 L406.985009,31.43125 C407.397723,29.1412589 408.751464,27.9948304 411.047187,27.9948304 L416.671375,27.9948304 C421.254223,27.9948304 424.900821,28.2030982 427.614036,28.6186786 C430.318652,29.0390357 432.926777,30.3373661 435.426946,32.5251339 C437.929027,34.7138571 439.177679,37.8923304 439.177679,42.0595982 C439.177679,50.8106696 436.882911,56.7482143 432.301018,59.8750982 Z"
                  id="Shape"
                  fill="#009CDE"></path>
              </g>
            </g>
          </g>
        </svg>
      ),
    },
    bank_transfer: {
      value: "bank_transfer",
      label: "Bonifico bancario",
      description: "Paga tramite bonifico bancario tradizionale.",
      icon: (
        <svg width="42" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="0.5" y="0.5" width="33" height="23" rx="3.5" fill="#C2C9FF" />
          <rect x="0.5" y="0.5" width="33" height="23" rx="3.5" stroke="#F9F7F6" />
          <g clip-path="url(#clip0_935_2)">
            <path
              d="M16.9376 5.75784C16.9988 5.74206 17.0646 5.74993 17.1212 5.78128L23.1212 9.11461C23.2207 9.1699 23.2707 9.28566 23.2423 9.39586C23.2137 9.50614 23.114 9.58336 23.0001 9.58336H11.0001C10.8862 9.58336 10.7865 9.50614 10.7579 9.39586C10.7295 9.28566 10.7795 9.1699 10.879 9.11461L16.879 5.78128L16.9376 5.75784ZM11.9649 9.08336H22.0353L17.0001 6.28584L11.9649 9.08336Z"
              fill="#010F22"
            />
            <path
              d="M22.3333 17.5V18H11.6667V17.5H22.3333ZM22.5 17.3333V16.6667C22.5 16.5746 22.4254 16.5 22.3333 16.5H11.6667C11.5746 16.5 11.5 16.5746 11.5 16.6667V17.3333C11.5 17.4254 11.5746 17.5 11.6667 17.5V18C11.2985 18 11 17.7015 11 17.3333V16.6667C11 16.2985 11.2985 16 11.6667 16H22.3333C22.7015 16 23 16.2985 23 16.6667V17.3333C23 17.7015 22.7015 18 22.3333 18V17.5C22.4254 17.5 22.5 17.4254 22.5 17.3333Z"
              fill="#010F22"
            />
            <path
              d="M12.75 15.3334V10.6667C12.75 10.5286 12.8619 10.4167 13 10.4167C13.1381 10.4167 13.25 10.5286 13.25 10.6667V15.3334C13.25 15.4714 13.1381 15.5834 13 15.5834C12.8619 15.5834 12.75 15.4714 12.75 15.3334Z"
              fill="#010F22"
            />
            <path
              d="M16.75 15.3334V10.6667C16.75 10.5286 16.8619 10.4167 17 10.4167C17.1381 10.4167 17.25 10.5286 17.25 10.6667V15.3334C17.25 15.4714 17.1381 15.5834 17 15.5834C16.8619 15.5834 16.75 15.4714 16.75 15.3334Z"
              fill="#010F22"
            />
            <path
              d="M20.75 15.3334V10.6667C20.75 10.5286 20.8619 10.4167 21 10.4167C21.1381 10.4167 21.25 10.5286 21.25 10.6667V15.3334C21.25 15.4714 21.1381 15.5834 21 15.5834C20.8619 15.5834 20.75 15.4714 20.75 15.3334Z"
              fill="#010F22"
            />
          </g>
        </svg>
      ),
    },
    revolut_pay: {
      value: "revolut_pay",
      label: "Revolut Pay",
      description: "Paga in modo rapido e sicuro con Revolut.",
      icon: (
        <svg width="138" height="24" viewBox="0 0 138 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="36" height="24" rx="3" fill="white"/>
          <path d="M33 0H3C1.34315 0 0 1.34315 0 3V21C0 22.6569 1.34315 24 3 24H33C34.6569 24 36 22.6569 36 21V3C36 1.34315 34.6569 0 33 0Z" fill="white"/>
          <path d="M24.1966 9H23.0973V14.9496H24.1966V9Z" fill="#191C1F"/>
          <path d="M31.9994 10.5833V11.5066H30.8628V13.5831C30.8628 13.7563 30.901 13.9067 30.9599 13.9662C31.024 14.0312 31.1349 14.0642 31.2893 14.0642H31.9994V14.9874H31.029C30.6016 14.9874 30.2804 14.8845 30.0742 14.6815C29.868 14.4786 29.7635 14.1713 29.7635 13.7681V9.37959H30.8628V10.5833H31.9994Z" fill="#191C1F"/>
          <path d="M15.6303 13.7916L16.7669 10.5832H17.9217L16.2809 14.9497H14.9796L13.3388 10.5832H14.4937L15.6303 13.7916Z" fill="#191C1F"/>
          <path d="M27.8434 13.4854C27.9285 13.2875 27.9717 13.047 27.9717 12.7706V10.5833H29.071V14.9496H28.1062L28.0077 14.4406C27.8777 14.5836 27.7119 14.7112 27.5138 14.8203C27.2968 14.9395 27.0123 15 26.6686 15C26.4301 15 26.2014 14.9671 25.9887 14.9022C25.7749 14.8369 25.5833 14.726 25.4193 14.5725C25.2551 14.4189 25.1231 14.2118 25.0271 13.9573C24.9311 13.7036 24.8825 13.3836 24.8825 13.0063V10.5833H25.9818V12.8885C25.9818 13.2855 26.0603 13.588 26.2153 13.7876C26.3687 13.9851 26.6059 14.0853 26.9202 14.0853C27.1398 14.0853 27.3294 14.0343 27.4836 13.9336C27.6379 13.833 27.7589 13.6822 27.8434 13.4854Z" fill="#191C1F"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M21.4169 10.8136C21.0705 10.6273 20.6591 10.5329 20.1944 10.5329C19.7354 10.5329 19.3255 10.6273 18.9762 10.8135C18.6265 11.0003 18.3518 11.264 18.1595 11.5973C17.9676 11.9304 17.8703 12.3252 17.8703 12.7706C17.8703 13.2106 17.9676 13.6026 18.1595 13.9357C18.3516 14.2689 18.6265 14.5326 18.9762 14.7193C19.3255 14.9055 19.7354 14.9999 20.1944 14.9999C20.6591 14.9999 21.0704 14.9055 21.4169 14.7192C21.7637 14.5326 22.037 14.2689 22.2292 13.9356C22.4212 13.6024 22.5186 13.2104 22.5186 12.7706C22.5186 12.3253 22.4212 11.9306 22.2292 11.5973C22.0369 11.2639 21.7636 11.0002 21.4169 10.8136ZM20.8361 13.9334C20.659 14.0453 20.4431 14.102 20.1944 14.102C19.9514 14.102 19.7369 14.0453 19.5569 13.9334C19.3765 13.8213 19.235 13.6632 19.1363 13.4633C19.0372 13.2632 18.9869 13.0302 18.9869 12.7706C18.9869 12.5057 19.0372 12.2713 19.1363 12.074C19.235 11.8768 19.3766 11.7186 19.5571 11.6037C19.7371 11.489 19.9516 11.4308 20.1944 11.4308C20.443 11.4308 20.6588 11.489 20.8359 11.6036C21.0136 11.7185 21.1537 11.8768 21.2526 12.074C21.3517 12.2719 21.402 12.5063 21.402 12.7706C21.402 13.0296 21.3517 13.2627 21.2526 13.4633C21.1538 13.6632 21.0136 13.8214 20.8361 13.9334Z" fill="#191C1F"/>
          <path d="M4 10.4683H5.14242V14.9497H4V10.4683Z" fill="#191C1F"/>
          <path d="M8.725 10.7246C8.725 9.7737 7.92677 9.00006 6.94556 9.00006H4V9.95708H6.80551C7.24956 9.95708 7.61739 10.2955 7.62551 10.7114C7.62957 10.9197 7.549 11.1162 7.39864 11.2649C7.24822 11.4135 7.04724 11.4955 6.83273 11.4955H5.73985C5.70104 11.4955 5.66946 11.5261 5.66946 11.5637V12.4143C5.66946 12.4287 5.67407 12.4426 5.68274 12.4542L7.53699 14.9497H8.89434L7.03578 12.4474C7.97175 12.4018 8.725 11.6389 8.725 10.7246Z" fill="#191C1F"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M11.0765 10.5329C11.518 10.5329 11.9088 10.6187 12.2379 10.7882C12.5669 10.9576 12.8286 11.2014 13.0156 11.5127C13.2019 11.8237 13.2994 12.1958 13.3053 12.6188C13.3053 12.6814 13.3037 12.7434 13.301 12.8054C13.2977 12.8691 13.2903 12.9325 13.2788 12.9939L13.2751 13.0135H9.97302V13.0486C9.98435 13.2728 10.0373 13.4704 10.1305 13.6346C10.2232 13.7982 10.3572 13.9267 10.5284 14.0165C10.7006 14.1068 10.8996 14.1526 11.12 14.1526C11.38 14.1526 11.6045 14.0917 11.7872 13.9716C11.9574 13.8599 12.0742 13.702 12.1344 13.5021L12.1396 13.485H13.2328L13.2268 13.5135C13.171 13.7815 13.057 14.0278 12.888 14.2456C12.7101 14.4747 12.4722 14.6598 12.1807 14.7957C11.8892 14.9313 11.5498 15 11.1719 15C10.6955 15 10.2769 14.907 9.92803 14.7236C9.57845 14.5401 9.30501 14.2778 9.11543 13.9439C8.92627 13.6108 8.83042 13.2189 8.83042 12.7791C8.83042 12.3279 8.92482 11.9303 9.11107 11.5976C9.2975 11.264 9.56348 11.0003 9.90154 10.8137C10.2391 10.6273 10.6344 10.5329 11.0765 10.5329ZM12.1848 12.2585C12.1419 11.9817 12.0251 11.7638 11.8373 11.6105C11.6432 11.4521 11.3901 11.3718 11.0851 11.3718C10.9047 11.3718 10.7346 11.4093 10.5797 11.4831C10.425 11.5567 10.2952 11.6619 10.1939 11.7957C10.0973 11.9233 10.0358 12.0789 10.011 12.2585H12.1848Z" fill="#191C1F"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M33 1H3C1.89543 1 1 1.89543 1 3V21C1 22.1046 1.89543 23 3 23H33C34.1046 23 35 22.1046 35 21V3C35 1.89543 34.1046 1 33 1ZM3 0H33C34.6569 0 36 1.34315 36 3V21C36 22.6569 34.6569 24 33 24H3C1.34315 24 0 22.6569 0 21V3C0 1.34315 1.34315 0 3 0Z" fill="black" fill-opacity="0.07"/>
          <rect x="51" width="36" height="24" rx="3" fill="white"/>
          <path d="M84 0H54C52.3431 0 51 1.34315 51 3V21C51 22.6569 52.3431 24 54 24H84C85.6569 24 87 22.6569 87 21V3C87 1.34315 85.6569 0 84 0Z" fill="white"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M66.1603 17.0447H71.8385V6.95533H66.1603V17.0447Z" fill="#FF5F00"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M66.5208 12C66.5214 11.0256 66.7451 10.0644 67.1749 9.18989C67.6046 8.31543 68.229 7.55102 69 6.95533C68.0448 6.21197 66.9011 5.74984 65.6976 5.62092C64.4941 5.492 63.2785 5.70139 62.1875 6.22555C61.0965 6.74972 60.1734 7.56786 59.522 8.58798C58.8705 9.60809 58.5166 10.7897 58.5 12C58.5166 13.2103 58.8705 14.3919 59.522 15.412C60.1734 16.4321 61.0965 17.2503 62.1875 17.7744C63.2785 18.2986 64.4941 18.508 65.6976 18.3791C66.9011 18.2501 68.0448 17.788 69 17.0447C68.229 16.449 67.6046 15.6846 67.1749 14.8101C66.7451 13.9356 66.5214 12.9743 66.5208 12Z" fill="#EB001B"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M79.297 15.976V15.7275H79.227L79.1512 15.899L79.0753 15.7275H79.01V15.976H79.0567V15.7882L79.1278 15.9503H79.1757L79.2468 15.7882V15.976H79.297ZM78.8805 15.976V15.7695H78.9645V15.7275H78.7498V15.7695H78.8338V15.976H78.8805ZM79.5 12C79.4834 13.2103 79.1295 14.3919 78.478 15.412C77.8266 16.4321 76.9035 17.2503 75.8125 17.7744C74.7215 18.2986 73.5059 18.508 72.3024 18.3791C71.0989 18.2501 69.9552 17.788 69 17.0447C69.7714 16.4493 70.396 15.685 70.8258 14.8104C71.2555 13.9359 71.479 12.9744 71.479 12C71.479 11.0256 71.2555 10.0641 70.8258 9.18956C70.396 8.31502 69.7714 7.55068 69 6.95533C69.9552 6.21197 71.0989 5.74984 72.3024 5.62092C73.5059 5.492 74.7215 5.70139 75.8125 6.22555C76.9035 6.74972 77.8266 7.56786 78.478 8.58798C79.1295 9.60809 79.4834 10.7897 79.5 12Z" fill="#F79E1B"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M84 1H54C52.8954 1 52 1.89543 52 3V21C52 22.1046 52.8954 23 54 23H84C85.1046 23 86 22.1046 86 21V3C86 1.89543 85.1046 1 84 1ZM54 0H84C85.6569 0 87 1.34315 87 3V21C87 22.6569 85.6569 24 84 24H54C52.3431 24 51 22.6569 51 21V3C51 1.34315 52.3431 0 54 0Z" fill="black" fill-opacity="0.07"/>
          <rect x="102" width="36" height="24" rx="3" fill="white"/>
          <path d="M135 0H105C103.343 0 102 1.34315 102 3V21C102 22.6569 103.343 24 105 24H135C136.657 24 138 22.6569 138 21V3C138 1.34315 136.657 0 135 0Z" fill="white"/>
          <path d="M119.298 7.65897L117.437 16.3633H115.185L117.047 7.65897H119.298ZM128.772 13.2795L129.958 10.0106L130.64 13.2795H128.772ZM131.286 16.3633H133.368L131.549 7.65897H129.628C129.195 7.65897 128.83 7.90995 128.669 8.297L125.29 16.3633H127.655L128.124 15.0634H131.013L131.286 16.3633ZM125.407 13.5215C125.417 11.2244 122.232 11.0972 122.253 10.0707C122.26 9.75886 122.557 9.42663 123.208 9.34166C123.53 9.29996 124.42 9.26648 125.429 9.73125L125.823 7.8845C125.281 7.68873 124.584 7.5 123.717 7.5C121.491 7.5 119.925 8.68248 119.912 10.3771C119.898 11.6303 121.031 12.329 121.883 12.7462C122.761 13.1728 123.055 13.4465 123.051 13.8277C123.045 14.4117 122.35 14.6703 121.704 14.6799C120.571 14.6977 119.915 14.3739 119.391 14.1297L118.982 16.038C119.51 16.2792 120.481 16.4892 121.486 16.5C123.853 16.5 125.4 15.3312 125.407 13.5215ZM116.081 7.65897L112.432 16.3633H110.052L108.256 9.41664C108.147 8.98946 108.053 8.83245 107.721 8.65194C107.18 8.35769 106.286 8.08263 105.5 7.91152L105.553 7.65897H109.385C109.873 7.65897 110.312 7.98376 110.424 8.54583L111.372 13.5831L113.715 7.65897H116.081Z" fill="#1434CB"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M135 1H105C103.895 1 103 1.89543 103 3V21C103 22.1046 103.895 23 105 23H135C136.105 23 137 22.1046 137 21V3C137 1.89543 136.105 1 135 1ZM105 0H135C136.657 0 138 1.34315 138 3V21C138 22.6569 136.657 24 135 24H105C103.343 24 102 22.6569 102 21V3C102 1.34315 103.343 0 105 0Z" fill="black" fill-opacity="0.07"/>
        </svg>

      ),
    },
    google_pay: {
      value: "google_pay",
      label: "Google Pay",
      description: "Paga in modo sicuro con Google Pay.",
      icon: <GooglePayMark />,
    },
  };

  if (loading || !pendingOrder) {
    return (
      <ContentCard
        title="Metodi di pagamento"
        icon={<PiCreditCardThin size="28px" />}
        contentPadding={0}
        contentPaddingMobile={0}>
        <div className="space-y-8 animate-pulse">
          <div className="space-y-4">
            <div className="h-6 bg-gray-200 rounded w-1/3"></div>
            <div className="border border-gray-200 rounded-lg p-4 space-y-3">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-gray-200 rounded"></div>
                <div className="flex-1 space-y-2">
                  <div className="h-4 bg-gray-200 rounded w-1/4"></div>
                  <div className="h-3 bg-gray-200 rounded w-3/4"></div>
                </div>
              </div>
            </div>
          </div>
          <div className="space-y-4">
            <div className="h-6 bg-gray-200 rounded w-1/3"></div>
            <div className="border border-gray-200 rounded-lg p-4 space-y-3">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-gray-200 rounded"></div>
                <div className="flex-1 space-y-2">
                  <div className="h-4 bg-gray-200 rounded w-1/4"></div>
                  <div className="h-3 bg-gray-200 rounded w-3/4"></div>
                </div>
              </div>
            </div>
            <div className="border border-gray-200 rounded-lg p-4 space-y-3">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-gray-200 rounded"></div>
                <div className="flex-1 space-y-2">
                  <div className="h-4 bg-gray-200 rounded w-1/4"></div>
                  <div className="h-3 bg-gray-200 rounded w-3/4"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ContentCard>
    );
  }

  return (
    <ContentCard
      title="Metodi di pagamento"
      icon={<PiCreditCardThin size="28px" />}
      contentPadding={0}
      contentPaddingMobile={0}>
      <div className="space-y-8">
        {isDepositOrder ? (
          // Per ordini deposit: mostra solo Santander e Klarna
          <div className="space-y-4">
            <h3>Finanziamento e pagamento dilazionato</h3>
            <PaymentRadioSelector
              method={paymentMethods.Santander}
              selectedMethod={paymentMethod}
              onMethodChange={onChange}
            />
            {showKlarna && (
              <PaymentRadioSelector
                method={paymentMethods.klarna}
                selectedMethod={paymentMethod}
                onMethodChange={onChange}
              />
            )}
          </div>
        ) : (
          // Per ordini normali: mostra tutti i metodi
          <>
            {showKlarna && (
              <div className="space-y-4">
                <h3>Pagamento dilazionato</h3>
                <PaymentRadioSelector
                  method={paymentMethods.klarna}
                  selectedMethod={paymentMethod}
                  onMethodChange={onChange}
                />
              </div>
            )}
            <div className="space-y-4">
              {showKlarna && <h3>Unica soluzione</h3>}
              <PaymentRadioSelector method={paymentMethods.card} selectedMethod={paymentMethod} onMethodChange={onChange} />
              <PaymentRadioSelector
                method={paymentMethods.bank_transfer}
                selectedMethod={paymentMethod}
                onMethodChange={onChange}
              />
              <PaymentRadioSelector method={paymentMethods.paypal} selectedMethod={paymentMethod} onMethodChange={onChange} />
              <PaymentRadioSelector method={paymentMethods.revolut_pay} selectedMethod={paymentMethod} onMethodChange={onChange} />
              <PaymentRadioSelector method={paymentMethods.google_pay} selectedMethod={paymentMethod} onMethodChange={onChange} />
            </div>
          </>
        )}
      </div>
    </ContentCard>
  );
};

export default PaymentsSelection;
